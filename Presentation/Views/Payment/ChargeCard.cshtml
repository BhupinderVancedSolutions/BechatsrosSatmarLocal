@model DTO.Request.TransactionRequestDto


<form id="charge-card">
    <div class="form-wapper">
        <div class="form-wapper_logo">
            <img src="~/assets/images/logo.png" alt="#" />

        </div>
        <div class="form-wapper_header">
            סובסקרייבט היינט און ברענגט א פארגעניגען פאר די גאנצע משפחה
        </div>
        <div class="form-wapper_form">
            <div class="form-box">
                <div class="form-header">
                    <h2>Customer Info</h2>
                    <input type="hidden" asp-for="ExpYear" />
                    <input type="hidden" asp-for="ExpMonth" />
                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="name">First Name*</label>
                            <input type="text" placeholder="First Name" class="form-control" asp-for="FirstName" id="FirstName">
                            <span asp-validation-for="FirstName" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="name">Last Name*</label>
                            <input type="text" placeholder="Last Name" class="form-control" asp-for="LastName" id="LastName">
                            <span asp-validation-for="LastName" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="name">Address*</label>
                            <input type="text" placeholder="Address" class="form-control" asp-for="Address" id="Address">
                            <span asp-validation-for="Address" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-3">
                        <div class="form-group">
                            <label for="City">City*</label>
                            <input type="text" placeholder="City" class="form-control" id="City" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-3">
                        <div class="form-group">
                            <label for="name">Zip*</label>
                            <input type="text" placeholder="Zip" class="form-control" asp-for="Zip" id="Zip" maxlength="5" onkeypress="return isNumber(event)">
                            <span asp-validation-for="Zip" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="name">Phone*</label>
                            <input type="text" placeholder="Phone Number" class="form-control" asp-for="PhoneNumber" maxlength="10" minlength="10" onkeypress="return isNumber(event)" autocomplete="off">
                            <span asp-validation-for="PhoneNumber" class="text-danger errormsg"></span>

                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="name">Email</label>
                            <input type="text" placeholder="Email" class="form-control" asp-for="Email" id="Email">
                        </div>
                    </div>
                </div>

            </div>

            <div class="check d-flex gap-1">
            <input type="checkbox" class="form-check-input " name="IsDeliveryAddress" asp-for="IsDeliveryAddress"checked>
                <label for="check">Deliver to a different address</label>
            </div>
                <div class="form-box showhide-CheckBox">
                    <div class="form-header">
                        <h2>Delivery Details</h2>
                    </div>

                    <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-3">
                            <div class="form-group">
                             <label for="name">Name*</label>
                            <input type="text" class="form-control" asp-for="DeliveryName" id="DeliveryName">
                            <span asp-validation-for="DeliveryName" class="text-danger errormsg"></span>
                            </div>
                        </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                            <div class="form-group">
                                <label for="name">Address*</label>
                            <input type="text" class="form-control" asp-for="DeliveryAddress" id="DeliveryAddress">
                            <span asp-validation-for="DeliveryAddress"  class="text-danger errormsg"></span>
                            </div>
                        </div>
                    <div class="col-sm-12 col-md-6 col-lg-3">
                        <div class="form-group">
                            <label for="DeliveryCity">DeliveryCity</label>
                            <input type="text" class="form-control" id="DeliveryCity" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-2">
                        <div class="form-group">
                            <label for="name">Zip*</label>
                            <input type="text" class="form-control" asp-for="DeliveryZip" maxlength="5" onkeypress="return isNumber(event)">
                            <span asp-validation-for="DeliveryZip" class="text-danger errormsg"></span>

                        </div>
                    </div>
                </div>

            <!-- Middle banner -->
            @if (@Model.UserId > 0)
            {
                <div class="form-middle-banner">
                    <p>פרייז</p>
                    <p>בלויז  $ פאר א יאהר</p>
                    <input type="number" class="form-control my-2 w-50 m-auto" asp-for="Amount" />
                    <h2 class="d-flex font-weight-bold justify-content-center">( $<div id="divAmountPerMonth">@Model.AmountPerMonth</div><span class="ms-2">Monthly</span> )</h2>
                    <p>(אריינגערעכענט פארגרעסערטע יו”ט אויסגאבעס)</p>
                    <input type="hidden" asp-for="AmountPerMonth" />
                </div>
            }
            else
            {
                <div class="form-middle-banner">
                    <p>פרייז</p>
                    <p>בלויז $@Model.Amount פאר א יאהר</p>
                    <h2>($@Model.AmountPerMonth Monthly)</h2>
                    <p>(אריינגערעכענט פארגרעסערטע יו”ט אויסגאבעס)</p>

                    <input type="hidden" asp-for="Amount" />
                    <input type="hidden" asp-for="AmountPerMonth" />
                </div>

            }

            <div class="form-box">
                <div class="form-header">
                    <h2>Payment Info</h2>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-4">
                        <div class="form-group">
                            <label for="name">Card Title*</label>
                            <input type="text" class="form-control" asp-for="CardTitle" id="CardTitle" placeholder="Card Title">
                            <span asp-validation-for="CardTitle" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                        <div class="form-group">
                            <label for="name">Card Number*</label>
                            <input type="text" class="form-control credit-card" asp-for="CreditCardNumber" placeholder="Card Number" maxlength="16" minlength="12" onkeypress="return isNumber(event)" autocomplete="off">
                            <span asp-validation-for="CreditCardNumber" class="text-danger errormsg"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-2">
                        <div class="form-group">
                            <label for="name">Exp.*</label>
                            <input type="text" class="form-control exp-date" asp-for="ExpDate" maxlength="4" minlength="3" placeholder="MMYY" onkeypress="return isNumber(event)" onchange="showHideExpDateErrorMsg()" autocomplete="off">
                            <span asp-validation-for="ExpDate" class="text-danger errormsg"></span>
                            <span class="error-msg text-danger errormsg d-none"></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-2">
                        <div class="form-group">
                            <label for="name">CVV*</label>
                            <input type="text" class="form-control cvv" asp-for="Cvv" placeholder="CVV" maxlength="4" placeholder="XXXX" onkeypress="return isNumber(event)">
                            <span asp-validation-for="Cvv" class="text-danger errormsg"></span>
                        </div>
                    </div>
                </div>

                <div class="check py-2 gap-1">
                    <input type="checkbox" class="form-input" name="IsAutoRenew" asp-for="IsAutoRenew">
                    <label for="check">Auto Renew</label>
                </div>

            </div>
            <div class="form-footer text-end">
                <button class="btn" id="resetBtn" onclick="resetCard()">Reset</button>
                <button type="button" class="btn btn-primary" onclick="chargeCard()">Confirm Order</button>
            </div>
        </div>
    </div>
</form>
<div class="overlay" style="display:none">
    <div class="loader"><img src="~/assets/images/loader.svg" /></div>
</div>

<script src="~/assets/js/chargecard/charge-card.js" asp-append-version="true"></script>

<script src="https://maps.googleapis.com/maps/api/js?v=3.26&libraries=places&key=AIzaSyC80AXqIsLG3EBinSky-Oynud0aT0Meijs"></script>
<script>
    function setupCityAutocomplete(inputId) {
        var cityInput = document.getElementById(inputId);
        cityInput.placeholder = ""; 
        var cityOptions = {
            types: ['(cities)'],
            componentRestrictions: {
                country: "us"
            }
        };
        var cityAutocomplete = new google.maps.places.Autocomplete(cityInput, cityOptions);
        cityAutocomplete.addListener('place_changed', function () {
            var place = cityAutocomplete.getPlace();
            console.log(place);
            if (place && place.address_components) {
                var cityState = "";
                var city, state;
                for (var i = 0; i < place.address_components.length; i++) {
                    var component = place.address_components[i];
                    if (component.types.includes('locality')) {
                        city = component.long_name;
                    } else if (component.types.includes('administrative_area_level_1')) {
                        state = component.short_name;
                    }
                }
                if (city && state) {
                    cityInput.value = city + ", " + state;
                }
            }
        });
    }

    setupCityAutocomplete('City');
    setupCityAutocomplete('DeliveryCity');
</script>












